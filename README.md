# PD-Build

The **Execution Kernel** of [ProductDesign OS](https://product-os.design). Transforms product decisions into tool-agnostic design logic (`.toon` files) that AI agents compile into implementation artifacts (`.cursorrules`, component specs, prompts).

> PD-Build lives inside your product repo — like Storybook. This repo is the template you copy into your project.

## The Problem

Design systems become dead documentation. A Figma library says "use 8px spacing" but nobody enforces it in code. AI agents generate UI without knowing your product's rules. The gap between design decisions and running code is filled by hope and manual reviews.

PD-Build closes that gap: **design logic as code, enforced by AI agents**.

## Architecture

### The 4-Layer Stack

```
01_Sources/   →  Inputs. Design briefs from PD-Spec, legacy code for bootstrap.
02_Kernel/    →  The brain. TOON objects, tokens, memory, conflicts. The SSoT.
03_Drivers/   →  Transformation logic. Prompts that compile TOON into tool-specific output.
04_Dist/      →  Generated artifacts. Staging for review, production for deployment.
```

Information flows in one direction: Sources → Kernel → Drivers → Dist. The Kernel is never modified by downstream output.

### In Your Product Repo

```
/my-webapp
├── pd-build/              # This template, copied here
│   ├── 01_Sources/
│   ├── 02_Kernel/
│   ├── 03_Drivers/
│   └── 04_Dist/
├── src/                   # Your product code
├── .cursorrules           # Generated by the Cursor driver (lives at root)
└── ...
```

## The TOON Format

**T**ext-based **O**bject **O**perational **N**otation. Token-efficient, readable by humans and AI agents.

```
OBJECT: FinancialInput
VERSION: 1.0.0
EXTENDS: BaseInput
CONTEXT: "Fintech / Withdrawal Flows"

DESC: "Input for financial assets with real-time balance validation."

LOGIC:
    format: currency_auto_format
    on_change: check_sufficient_funds
    rules:
        min: dynamic_from_asset_config
        max: user_balance_limit

STATES:
    [default]
        surface: surface-neutral-subtle
        border: border-default

    [error_insufficient]
        @trigger: input_value > available_balance
        surface: surface-signal-critical-subtle
        border: border-signal-critical
        feedback:
            icon: alert-circle
            msg: "Insufficient balance for this operation"

DATA_SOURCE: [TRACED] PD-Spec Brief #42, IG-07
```

## Data Traceability

Every rule in the Kernel carries a provenance label:

- **`[TRACED]`** — Backed by evidence from PD-Spec (ProductLM). References an `[IG-XX]` insight. AI agents cannot modify this logic.
- **`[HYPOTHESIS]`** — Generated via Bootstrap from benchmarks or existing code. AI agents treat this as experimental and flag it for validation with real telemetry.

**Golden Rule:** A `[HYPOTHESIS]` can never overwrite a `[TRACED]` decision.

## The Pipeline

```
1. Ingest      →  Import brief or bootstrap code, tag as TRACED or HYPOTHESIS
2. Audit       →  Scan Kernel for inheritance conflicts and logic collisions
3. Draft       →  Driver generates artifacts in 04_Dist/staging/
4. Review      →  Architect compares diff: staging vs production
5. Deploy      →  Approved artifacts move to production/ and root .cursorrules
```

## Conflict Resolution

When the Kernel detects a collision (e.g., a child object overriding a parent's `[TRACED]` rule), it halts and writes a conflict card:

```
ID: CF-001
OBJECT: FinancialInput (Extends BaseInput)
CONFLICT: [TRACED] rule in BaseInput (min_length: 1) contradicted by
          [HYPOTHESIS] rule in FinancialInput (min_length: 0).
OPTIONS:
  1. OVERRIDE — Prioritize child logic.
  2. REJECT — Keep parent rule.
  3. MERGE — Create conditional logic.
```

The Architect resolves with `/resolve CF-001 --option 2`.

## Connection to PD-Spec

PD-Build receives its strategic input from PD-Spec via a `DESIGN_BRIEF.md`:

```
PD-Spec (separate repo)               PD-Build (inside product repo)
Research → Decisions → Brief    →      Brief → Kernel → Drivers → .cursorrules
```

The brief must contain: `[INTENT]`, `[LOGIC_RULES]`, `[DATA_EVIDENCE]`, `[USER_FLOW]`.

Transfer mechanism (v1.0): manual copy-paste from PD-Spec's `03_Outputs/` to `pd-build/01_Sources/specs/`.

## Getting Started

```bash
# 1. Copy pd-build/ into your product repo
cp -r pd-build/ /path/to/my-webapp/pd-build/

# 2. Place a DESIGN_BRIEF.md in 01_Sources/specs/
#    Or place existing code/screenshots in 01_Sources/bootstrap/

# 3. Create your first TOON object in 02_Kernel/objects/

# 4. Run the Cursor driver to generate .cursorrules

# 5. Build with AI — the rules are now enforced automatically
```

## Repo Structure

```
├── 01_Sources/                  Inputs (read-only after placement)
│   ├── specs/                   DESIGN_BRIEF.md from PD-Spec
│   ├── bootstrap/               Legacy code, screenshots, raw notes
│   └── _README.md              Layer guide
├── 02_Kernel/                   Source of Truth
│   ├── global/                  Base tokens, grids, elevation (.toon)
│   ├── objects/                 Component definitions (.toon)
│   ├── MEMORY.md                Session log & compilation history
│   ├── CONFLICTS.md             Inheritance and logic collisions
│   └── _README.md              Layer guide
├── 03_Drivers/                  Transformation Logic
│   ├── logic/                   System prompts (audit, build, resolve)
│   ├── templates/               Output blueprints (.cursorrules, .css)
│   └── _README.md              Layer guide
├── 04_Dist/                     Generated Artifacts
│   ├── staging/                 Proposals pending review (git-ignored)
│   ├── production/              Approved artifacts (persistent)
│   └── _README.md              Layer guide
├── CLAUDE.md                    AI agent protocol
├── CHANGELOG.md                 Version history
├── IMPLEMENTATION.md            Build plan and next steps
└── README.md                    This file
```

## License

[MIT](LICENSE)
